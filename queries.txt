select  cstatus 
from log;

--quantidades registros que existem no log
select count(status) as erros
from log l
where l.status = '404 NOT FOUND';

--quais dias ocorreram erros 404
select time
from log l
where l.status = '404 NOT FOUND';

select distinct date_trunc('day', time)
from log l
where l.status = '404 NOT FOUND';


--dias que ocorreram erros
select distinct to_char(time, 'dd/mm/yyyy')
from log l
where l.status = '404 NOT FOUND';

select date_trunc()


--quantidades de  erros por dia
select to_char(time, 'dd/mm/yyyy') as data , count(*) as qtd
from log l
where l.status = '404 NOT FOUND'
group by data 




order by data;

select distinct date_trunc('day', time) as data ,count(*) as qtd
from log l
where l.status = '404 NOT FOUND'
group by data 
order by data;

Pesquisando por dia


select *
FROM log 
where date_trunc('day', time) = date_trunc('day', timestamp, '2016-07-01 00:00:00+00')


quantidades de requisições por dia

select count(*)
from log where date_trunc('day', time) = date_trunc('day', TIMESTAMP '2016-07-01 00:00:00+00')



select percentage.date as date, round((percentage.errors/percentage.requests)*100, 1) as perc
from(
select data.date, sum(data.requests) as requests, sum(data.qtderrors) as errors
from (
select distinct date_trunc('day', time) as date , 0 requests, count(*) as qtderrors
from log l
where l.status = '404 NOT FOUND'
group by date
union
select date_trunc('day', time) date, count(*) requests, 0 as qtderrors
from log
group by date
) as data
group by data.date
) as percentage
where round((percentage.errors/percentage.requests)*100, 1) > 1


---------------------------------------------------------------------------------------------
select to_char(percentage.date, 'Month DD, YYYY') as date, percentage.errors || '% errors' as percentage
from(
select data.date, round(sum(data.qtderrors)/sum(data.requests)*100, 1) as errors
from (
select distinct date_trunc('day', time) as date , 0 requests, count(*) as qtderrors
from log l
where l.status = '404 NOT FOUND'
group by date
union
select date_trunc('day', time) date, count(*) requests, 0 as qtderrors
from log
group by date
) as data
group by data.date
) as percentage
where percentage.errors > 1
